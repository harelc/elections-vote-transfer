<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <script>if(/Android|iPhone|iPod/i.test(navigator.userAgent)&&!location.search.includes('desktop')){var lp=new URLSearchParams(location.search).get('lang');location.replace('m/index.html'+(lp?'?lang='+lp:''))}</script>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:type" content="website">
    <meta property="og:title" content="×§×•×œ×•×ª × ×•×“×“×™× â€” × ×™×ª×•×— × ×ª×•× ×™ ×‘×—×™×¨×•×ª ×œ×›× ×¡×ª">
    <meta property="og:description" content="× ×™×ª×•×— ××™× ×˜×¨××§×˜×™×‘×™ ×©×œ × ×ª×•× ×™ ×‘×—×™×¨×•×ª ×œ×›× ×¡×ª â€” Interactive Israeli Knesset election data analysis">
    <meta property="og:image" content="https://kolot-nodedim.netlify.app/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <title>×§×•×œ×•×ª × ×•×“×“×™× - × ×™×ª×•×— × ×ª×•× ×™ ×‘×—×™×¨×•×ª ×œ×›× ×¡×ª ×™×©×¨××œ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="i18n.css">
    <script src="i18n.js"></script>
    <style>
        .dashboard-hero {
            text-align: center;
            padding: 3rem 1.5rem 2rem;
            position: relative;
        }
        .dashboard-hero .site-title {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }
        .dashboard-hero .title-icon {
            font-size: 2.4rem;
            margin-inline-end: 0.5rem;
        }
        .dashboard-hero .site-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 2rem;
        }
        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 1.5rem 2rem;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
            max-width: 1100px;
            margin-left: auto;
            margin-right: auto;
        }
        .hero-stat {
            text-align: center;
        }
        .hero-stat-value {
            display: block;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--accent-primary);
            line-height: 1.2;
        }
        .hero-stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }


        /* Views + archive layout */
        .views-with-archive {
            display: flex;
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto 2rem;
            padding: 0 1.5rem;
            align-items: stretch;
            justify-content: center;
        }
        .archive-side {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            align-items: center;
            justify-content: center;
        }
        .archive-side img {
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            opacity: 0.75;
            transition: opacity 0.3s, transform 0.3s;
            cursor: pointer;
            height: 420px;
            width: auto;
            object-fit: contain;
        }
        .archive-side img:hover {
            opacity: 1;
            transform: scale(1.02);
        }
        .archive-credit {
            font-size: 0.7rem;
            color: var(--text-muted);
            max-width: 240px;
            text-align: center;
            line-height: 1.4;
        }
        /* Hide side images on narrow screens */
        @media (max-width: 1200px) {
            .views-with-archive { justify-content: center; }
            .archive-side { display: none; }
        }

        /* View cards grid */
        .views-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(240px, 1fr));
            gap: 1.25rem;
            max-width: 900px;
        }
        @media (max-width: 1200px) {
            .views-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                max-width: 1100px;
                padding: 0;
            }
        }
        .view-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-decoration: none;
            color: inherit;
            transition: transform var(--transition-normal), border-color var(--transition-normal), box-shadow var(--transition-normal);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .view-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-glow);
        }
        .view-card-icon {
            font-size: 1.8rem;
            line-height: 1;
        }
        .view-card-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .view-card-desc {
            font-size: 0.88rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .view-card-arrow {
            margin-top: auto;
            font-size: 0.82rem;
            color: var(--accent-primary);
            font-weight: 500;
        }

        .dashboard-footer {
            text-align: center;
            padding: 2rem 1.5rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        .dashboard-footer a {
            color: var(--accent-primary);
            text-decoration: none;
        }
        .dashboard-footer a:hover {
            text-decoration: underline;
        }

        /* Language toggle + discussions on dashboard */
        .dashboard-lang {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        [dir="ltr"] .dashboard-lang {
            left: auto;
            right: 1.5rem;
        }
        .dashboard-discuss {
            font-size: 0.82rem;
            color: var(--text-muted);
            text-decoration: none;
        }
        .dashboard-discuss:hover {
            color: var(--accent-primary);
        }
        .dashboard-info-btn {
            background: none;
            border: 1px solid var(--border-color, #333);
            color: var(--text-muted, #888);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: border-color 0.15s;
        }
        .dashboard-info-btn:hover { border-color: var(--accent-primary); }
        .info-overlay-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 500;
        }
        .info-overlay-backdrop.visible { display: block; }
        .info-overlay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary, #1a1a2e);
            border: 1px solid var(--border-color, #333);
            border-radius: 12px;
            padding: 2rem;
            z-index: 501;
            width: 420px;
            max-width: calc(100% - 2rem);
            max-height: 80vh;
            overflow-y: auto;
            color: var(--text-primary);
        }
        .info-overlay.visible { display: block; }
        .info-overlay h3 { font-size: 1.1rem; margin-bottom: 0.5rem; }
        .info-overlay p { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem; }
        .info-overlay a { color: var(--accent-primary); }
        .info-overlay .bmc-inline {
            display: inline-flex; align-items: center; gap: 6px;
            background: #FFDD00; color: #000; padding: 8px 14px;
            border-radius: 8px; text-decoration: none; font-size: 0.85rem; font-weight: 600;
        }
        .info-overlay .bmc-inline img { width: 18px; height: 18px; }
        .info-overlay .close-btn {
            position: absolute; top: 10px; left: 10px;
            background: none; border: none; color: var(--text-muted);
            font-size: 1.3rem; cursor: pointer; padding: 4px;
        }
        [dir="ltr"] .info-overlay .close-btn { left: auto; right: 10px; }
    </style>
</head>
<body>
    <div class="info-overlay-backdrop" id="info-backdrop"></div>
    <div class="info-overlay" id="info-overlay"></div>

    <!-- Animated sand dunes -->
    <div class="dunes-container">
        <div class="dune dune-3"></div>
        <div class="dune dune-2"></div>
        <div class="dune dune-1"></div>
    </div>

    <div class="app-container">
        <section class="dashboard-hero">
            <div class="dashboard-lang" id="lang-container">
                <button class="dashboard-info-btn" id="info-btn" title="About">â„¹</button>
                <a href="discussions.html" class="dashboard-discuss" data-i18n="nav_discussions">×“×™×•× ×™×</a>
            </div>
            <h1 class="site-title">
                <span class="title-icon">ğŸ—³ï¸</span>
                <span data-i18n="dashboard_title">×§×•×œ×•×ª × ×•×“×“×™×</span>
            </h1>
            <p class="site-subtitle" data-i18n="dashboard_subtitle">× ×™×ª×•×— ××™× ×˜×¨××§×˜×™×‘×™ ×©×œ × ×ª×•× ×™ ×‘×—×™×¨×•×ª ×œ×›× ×¡×ª ×™×©×¨××œ</p>

            <div class="hero-stats">
                <div class="hero-stat">
                    <span class="hero-stat-value" id="stat-elections">10</span>
                    <span class="hero-stat-label" data-i18n="dashboard_stat_elections">×›× ×¡×•×ª</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value" id="stat-lists">â€”</span>
                    <span class="hero-stat-label" data-i18n="dashboard_stat_lists">×¨×©×™××•×ª</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value" id="stat-settlements">â€”</span>
                    <span class="hero-stat-label" data-i18n="dashboard_stat_settlements">×™×™×©×•×‘×™×</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value" id="stat-ballots">â€”</span>
                    <span class="hero-stat-label" data-i18n="dashboard_stat_ballots">×§×œ×¤×™×•×ª</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value" id="stat-eligible">â€”</span>
                    <span class="hero-stat-label" data-i18n="eligible_voters">×‘×¢×œ×™ ×–×›×•×ª ×‘×—×™×¨×”</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value" id="stat-voted">â€”</span>
                    <span class="hero-stat-label" data-i18n="voted">×”×¦×‘×™×¢×•</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-value" id="stat-visitors">â€”</span>
                    <span class="hero-stat-label" data-i18n="dashboard_stat_visitors">××‘×§×¨×™× ×‘××ª×¨</span>
                </div>
            </div>
        </section>

        <div class="views-with-archive">
            <div class="archive-side" id="archive-left"></div>
            <section class="views-grid" id="views-grid"></section>
            <div class="archive-side" id="archive-right"></div>
        </div>

        <footer class="dashboard-footer">
            <p>
                <span data-i18n="credits_line">Â© ×”×¨××œ ×§×™×Ÿ</span> |
                <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> |
                <a href="https://github.com/harelc/elections-vote-transfer/" target="_blank" data-i18n="source_code">×§×•×“ ××§×•×¨</a>
            </p>
        </footer>
    </div>

    <script>
    (function() {
        // Language toggle
        i18n.injectLangToggle('#lang-container');
        i18n.renderBMC();

        // Info overlay
        function showInfo() {
            document.getElementById('info-overlay').innerHTML =
                '<button class="close-btn" id="info-close">\u2715</button>' +
                '<h3>' + i18n.t('about_site') + '</h3>' +
                '<p>' + i18n.t('about_description') + '</p>' +
                '<h3>' + i18n.t('license') + '</h3>' +
                '<p>CC BY-NC-SA 4.0 &nbsp;|&nbsp; ' + i18n.t('credits_line') + '</p>' +
                '<p><a href="https://github.com/harelkain/elections-vote-transfer" target="_blank">' + i18n.t('source_code') + '</a></p>' +
                '<a href="https://www.buymeacoffee.com/harelc" target="_blank" class="bmc-inline">' +
                    '<img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="">' +
                    '<span>' + i18n.t('bmc_title') + '</span>' +
                '</a>' +
                '<br><br>' +
                '<a href="discussions.html" style="font-size:0.9rem">' + i18n.t('feedback_question') + '</a>';
            document.getElementById('info-overlay').classList.add('visible');
            document.getElementById('info-backdrop').classList.add('visible');
            document.getElementById('info-close').onclick = hideInfo;
        }
        function hideInfo() {
            document.getElementById('info-overlay').classList.remove('visible');
            document.getElementById('info-backdrop').classList.remove('visible');
        }
        document.getElementById('info-btn').onclick = showInfo;
        document.getElementById('info-backdrop').onclick = hideInfo;

        // View cards
        const cards = [
            { icon: 'ğŸ—ºï¸', i18n_title: 'nav_geomap',    i18n_desc: 'card_geomap_desc',    href: 'geomap.html' },
            { icon: 'ğŸ”µ', i18n_title: 'nav_tsne',      i18n_desc: 'card_tsne_desc',      href: 'tsne.html' },
            { icon: 'ğŸ”€', i18n_title: 'nav_sankey',    i18n_desc: 'card_sankey_desc',    href: 'sankey.html' },
            { icon: 'ğŸ“ˆ', i18n_title: 'nav_scatter',    i18n_desc: 'card_scatter_desc',   href: 'scatter.html' },
            { icon: 'ğŸ“', i18n_title: 'settlement_profile', i18n_desc: 'card_settlement_desc', href: 'settlement.html' },
            { icon: 'ğŸª', i18n_title: 'party_profile', i18n_desc: 'card_party_desc', href: 'party.html' },
            { icon: 'ğŸ›ï¸', i18n_title: 'nav_dhondt',    i18n_desc: 'card_dhondt_desc',    href: 'dhondt.html' },
            { icon: 'ğŸ§©', i18n_title: 'nav_regional',  i18n_desc: 'card_regional_desc',  href: 'regional.html' },
            { icon: 'ğŸ”', i18n_title: 'nav_irregular',  i18n_desc: 'card_irregular_desc', href: 'irregular.html' },
            { icon: 'ğŸ“Š', i18n_title: 'nav_rankings',    i18n_desc: 'card_rankings_desc',  href: 'rankings.html' },
        ];

        const grid = document.getElementById('views-grid');
        const arrowHe = 'â†', arrowEn = 'â†’';
        cards.forEach(c => {
            const a = document.createElement('a');
            a.className = 'view-card';
            a.href = c.href;
            a.innerHTML =
                '<span class="view-card-icon">' + c.icon + '</span>' +
                '<span class="view-card-title" data-i18n="' + c.i18n_title + '">' + i18n.t(c.i18n_title) + '</span>' +
                '<span class="view-card-desc" data-i18n="' + c.i18n_desc + '">' + i18n.t(c.i18n_desc) + '</span>' +
                '<span class="view-card-arrow">' + (i18n.isRTL() ? arrowHe : arrowEn) + '</span>';
            grid.appendChild(a);
        });

        // Animate a number from 0 to target with rolling digits
        function animateNumber(el, target, duration) {
            if (!el || !target) return;
            const start = performance.now();
            const fmt = v => i18n.fmtNum(Math.round(v));
            el.textContent = fmt(0);
            function step(now) {
                const t = Math.min((now - start) / duration, 1);
                // ease-out cubic
                const ease = 1 - Math.pow(1 - t, 3);
                el.textContent = fmt(ease * target);
                if (t < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        // Load stats from map data (all elections for max ballots, latest for rest)
        Promise.all(
            ['16','17','18','19','20','21','22','23','24','25'].map(e =>
                fetch('data/map_' + e + '.json').then(r => r.json()).catch(() => null)
            )
        ).then(all => {
            const maps = all.filter(Boolean);
            if (!maps.length) return;
            const maxBallots = Math.max(...maps.map(m => m.stats.totalBallots));
            const latest = maps[maps.length - 1];
            animateNumber(document.getElementById('stat-ballots'), maxBallots, 1200);
            animateNumber(document.getElementById('stat-settlements'), latest.stats.totalSettlements, 1200);
            animateNumber(document.getElementById('stat-eligible'), latest.stats.totalEligible, 1500);
            animateNumber(document.getElementById('stat-voted'), latest.stats.totalVoters, 1500);
            animateNumber(document.getElementById('stat-lists'), latest.stats.totalLists, 800);
        }).catch(() => {});

        // Visitor counter using CountAPI
        (function loadVisitorCount() {
            const STORAGE_KEY = 'kolot_visit_counted';
            const API_NS = 'kolot-nodedim';
            const API_KEY = 'page-visits';

            const alreadyCounted = sessionStorage.getItem(STORAGE_KEY);
            const endpoint = alreadyCounted
                ? 'https://api.counterapi.dev/v1/' + API_NS + '/' + API_KEY + '/'
                : 'https://api.counterapi.dev/v1/' + API_NS + '/' + API_KEY + '/up';

            fetch(endpoint)
                .then(r => r.json())
                .then(data => {
                    const count = data.count || data.value || 0;
                    if (count > 0) {
                        animateNumber(document.getElementById('stat-visitors'), count, 1200);
                        if (!alreadyCounted) sessionStorage.setItem(STORAGE_KEY, '1');
                    }
                })
                .catch(() => {});
        })();

        // Random archive photos
        (function() {
            const photos = [
                'images/archive_poster_1.jpg','images/archive_poster_2.jpg',
                'images/archive_photo_3.jpg','images/archive_photo_4.jpg',
                'images/archive_photo_5.jpg','images/archive_photo_6.jpg',
                'images/archive_photo_7.jpg','images/archive_photo_8.jpg',
                'images/archive_photo_9.jpg','images/archive_photo_10.jpg',
                'images/archive_photo_11.jpg','images/archive_photo_12.jpg'
            ];
            const shuffled = photos.sort(() => Math.random() - 0.5);
            const pick = shuffled.slice(0, 2);
            ['archive-left','archive-right'].forEach((id, i) => {
                const el = document.getElementById(id);
                el.innerHTML =
                    '<img src="' + pick[i] + '" alt="' + i18n.t('archive_credit') + '" loading="lazy">' +
                    '<div class="archive-credit" data-i18n="archive_credit">' + i18n.t('archive_credit') + '</div>';
            });
        })();

        // Update arrows on language change
        window.addEventListener('langchange', () => {
            i18n.applyTranslations();
            document.querySelectorAll('.view-card-arrow').forEach(el => {
                el.textContent = i18n.isRTL() ? arrowHe : arrowEn;
            });
        });
    })();
    </script>
</body>
</html>
