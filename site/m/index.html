<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta property="og:type" content="website">
    <meta property="og:title" content="×§×•×œ×•×ª × ×•×“×“×™× â€” × ×™×ª×•×— × ×ª×•× ×™ ×‘×—×™×¨×•×ª ×œ×›× ×¡×ª">
    <meta property="og:description" content="× ×™×ª×•×— ××™× ×˜×¨××§×˜×™×‘×™ ×©×œ × ×ª×•× ×™ ×‘×—×™×¨×•×ª ×œ×›× ×¡×ª â€” Interactive Israeli Knesset election data analysis">
    <meta property="og:image" content="https://kolot-nodedim.netlify.app/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <title>×§×•×œ×•×ª × ×•×“×“×™× - × ×™×ª×•×— × ×ª×•× ×™ ×‘×—×™×¨×•×ª ×œ×›× ×¡×ª ×™×©×¨××œ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="../i18n.css">
    <script src="../i18n.js"></script>
    <style>
        html, body {
            overflow: auto;
            height: auto;
            min-height: 100%;
        }
        .m-dashboard {
            padding: 1.5rem 1rem calc(58px + var(--safe-bottom));
            text-align: center;
        }
        .m-hero-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }
        .m-hero-title .icon { font-size: 1.5rem; margin-inline-end: 0.3rem; }
        .m-hero-subtitle {
            font-size: 0.88rem;
            color: var(--text-secondary);
            margin-bottom: 1.2rem;
            line-height: 1.4;
        }
        .m-hero-stats {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }
        .m-stat-value {
            display: block;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--accent);
            line-height: 1.2;
        }
        .m-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .m-cards {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .m-card {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.9rem;
            text-decoration: none;
            color: inherit;
            transition: border-color 0.15s;
            text-align: start;
        }
        .m-card:active { border-color: var(--accent); }
        .m-card-icon { font-size: 1.5rem; flex-shrink: 0; }
        .m-card-text { min-width: 0; }
        .m-card-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .m-card-desc {
            font-size: 0.78rem;
            color: var(--text-secondary);
            line-height: 1.3;
            margin-top: 0.15rem;
        }
        .m-lang-btn {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        [dir="ltr"] .m-lang-btn { left: auto; right: 10px; }
        .m-discuss-link {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-decoration: none;
        }
        .m-info-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-muted);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .m-info-btn:active { border-color: var(--accent); }
        .info-overlay-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 500;
        }
        .info-overlay-backdrop.visible { display: block; }
        .info-overlay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            z-index: 501;
            width: calc(100% - 2rem);
            max-width: 360px;
            max-height: 80vh;
            overflow-y: auto;
            color: var(--text-primary);
        }
        .info-overlay.visible { display: block; }
        .info-overlay h3 { font-size: 1rem; margin-bottom: 0.5rem; }
        .info-overlay p { font-size: 0.82rem; color: var(--text-secondary); line-height: 1.5; margin-bottom: 0.8rem; }
        .info-overlay a { color: var(--accent); }
        .info-overlay .bmc-inline {
            display: inline-flex; align-items: center; gap: 6px;
            background: #FFDD00; color: #000; padding: 6px 12px;
            border-radius: 6px; text-decoration: none; font-size: 0.8rem; font-weight: 600;
        }
        .info-overlay .bmc-inline img { width: 16px; height: 16px; }
        .info-overlay .close-btn {
            position: absolute; top: 8px; left: 8px;
            background: none; border: none; color: var(--text-muted);
            font-size: 1.2rem; cursor: pointer; padding: 4px;
        }
        [dir="ltr"] .info-overlay .close-btn { left: auto; right: 8px; }
    </style>
</head>
<body>
    <div class="m-lang-btn" id="lang-container">
        <button class="m-info-btn" id="info-btn" title="About">â„¹</button>
    </div>

    <div class="info-overlay-backdrop" id="info-backdrop"></div>
    <div class="info-overlay" id="info-overlay"></div>

    <div class="m-dashboard">
        <h1 class="m-hero-title">
            <span class="icon">ğŸ—³ï¸</span>
            <span data-i18n="dashboard_title">×§×•×œ×•×ª × ×•×“×“×™×</span>
        </h1>
        <p class="m-hero-subtitle" data-i18n="dashboard_subtitle">× ×™×ª×•×— ××™× ×˜×¨××§×˜×™×‘×™ ×©×œ × ×ª×•× ×™ ×‘×—×™×¨×•×ª ×œ×›× ×¡×ª ×™×©×¨××œ</p>

        <div class="m-hero-stats">
            <div>
                <span class="m-stat-value" id="stat-elections">10</span>
                <span class="m-stat-label" data-i18n="dashboard_stat_elections">×›× ×¡×•×ª</span>
            </div>
            <div>
                <span class="m-stat-value" id="stat-lists">â€”</span>
                <span class="m-stat-label" data-i18n="dashboard_stat_lists">×¨×©×™××•×ª</span>
            </div>
            <div>
                <span class="m-stat-value" id="stat-settlements">â€”</span>
                <span class="m-stat-label" data-i18n="dashboard_stat_settlements">×™×™×©×•×‘×™×</span>
            </div>
            <div>
                <span class="m-stat-value" id="stat-ballots">â€”</span>
                <span class="m-stat-label" data-i18n="dashboard_stat_ballots">×§×œ×¤×™×•×ª</span>
            </div>
        </div>
        <div class="m-hero-stats" style="margin-top:0">
            <div>
                <span class="m-stat-value" id="stat-eligible">â€”</span>
                <span class="m-stat-label" data-i18n="eligible_voters">×‘×¢×œ×™ ×–×›×•×ª ×‘×—×™×¨×”</span>
            </div>
            <div>
                <span class="m-stat-value" id="stat-voted">â€”</span>
                <span class="m-stat-label" data-i18n="voted">×”×¦×‘×™×¢×•</span>
            </div>
            <div>
                <span class="m-stat-value" id="stat-visitors">â€”</span>
                <span class="m-stat-label" data-i18n="dashboard_stat_visitors">××‘×§×¨×™× ×‘××ª×¨</span>
            </div>
        </div>

        <div class="m-cards" id="cards"></div>
    </div>

    <!-- Bottom Tabs -->
    <nav class="tab-bar">
        <a href="geomap.html"><span class="tab-icon">ğŸ—ºï¸</span><span data-i18n="tab_map">××¤×”</span></a>
        <a href="tsne.html"><span class="tab-icon">ğŸ”µ</span><span data-i18n="tab_tsne">×¤×™×–×•×¨</span></a>
        <a href="sankey.html"><span class="tab-icon">ğŸ”€</span><span data-i18n="tab_sankey">× ×“×™×“×”</span></a>
        <a href="scatter.html"><span class="tab-icon">ğŸ“ˆ</span><span data-i18n="tab_scatter">×”×©×•×•××”</span></a>
        <a href="dhondt.html"><span class="tab-icon">ğŸ›ï¸</span><span data-i18n="tab_dhondt">×× ×“×˜×™×</span></a>
        <a href="regional.html"><span class="tab-icon">ğŸ§©</span><span data-i18n="tab_regional">××–×•×¨×™</span></a>
        <a href="discussions.html"><span class="tab-icon">ğŸ’¬</span><span data-i18n="nav_discussions">×“×™×•× ×™×</span></a>
    </nav>

    <script>
    (function() {
        i18n.injectLangToggle('#lang-container');
        i18n.renderMobileBMC();

        // Info overlay
        function showInfo() {
            document.getElementById('info-overlay').innerHTML =
                '<button class="close-btn" id="info-close">\u2715</button>' +
                '<h3>' + i18n.t('about_site') + '</h3>' +
                '<p>' + i18n.t('about_description') + '</p>' +
                '<h3>' + i18n.t('license') + '</h3>' +
                '<p>CC BY-NC-SA 4.0 &nbsp;|&nbsp; ' + i18n.t('credits_line') + '</p>' +
                '<p><a href="https://github.com/harelkain/elections-vote-transfer" target="_blank">' + i18n.t('source_code') + '</a></p>' +
                '<a href="https://www.buymeacoffee.com/harelc" target="_blank" class="bmc-inline">' +
                    '<img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="">' +
                    '<span>' + i18n.t('bmc_title') + '</span>' +
                '</a>' +
                '<br><br>' +
                '<a href="discussions.html" style="font-size:0.82rem">' + i18n.t('feedback_question') + '</a>';
            document.getElementById('info-overlay').classList.add('visible');
            document.getElementById('info-backdrop').classList.add('visible');
            document.getElementById('info-close').onclick = hideInfo;
        }
        function hideInfo() {
            document.getElementById('info-overlay').classList.remove('visible');
            document.getElementById('info-backdrop').classList.remove('visible');
        }
        document.getElementById('info-btn').onclick = showInfo;
        document.getElementById('info-backdrop').onclick = hideInfo;

        const cards = [
            { icon: 'ğŸ—ºï¸', i18n_title: 'nav_geomap',    i18n_desc: 'card_geomap_desc',    href: 'geomap.html' },
            { icon: 'ğŸ”µ', i18n_title: 'nav_tsne',      i18n_desc: 'card_tsne_desc',      href: 'tsne.html' },
            { icon: 'ğŸ”€', i18n_title: 'nav_sankey',    i18n_desc: 'card_sankey_desc',    href: 'sankey.html' },
            { icon: 'â–¶', i18n_title: 'nav_animation',  i18n_desc: 'card_animation_desc', href: '../animation.html' },
            { icon: 'ğŸ“ˆ', i18n_title: 'nav_scatter',    i18n_desc: 'card_scatter_desc',   href: 'scatter.html' },
            { icon: 'ğŸ“', i18n_title: 'settlement_profile', i18n_desc: 'card_settlement_desc', href: 'settlement.html' },
            { icon: 'ğŸª', i18n_title: 'party_profile', i18n_desc: 'card_party_desc', href: 'party.html' },
            { icon: 'ğŸ›ï¸', i18n_title: 'nav_dhondt',    i18n_desc: 'card_dhondt_desc',    href: 'dhondt.html' },
            { icon: 'ğŸ§©', i18n_title: 'nav_regional',  i18n_desc: 'card_regional_desc',  href: 'regional.html' },
            { icon: 'ğŸ”', i18n_title: 'nav_irregular',  i18n_desc: 'card_irregular_desc', href: 'irregular.html' },
            { icon: 'ğŸ“Š', i18n_title: 'nav_rankings',    i18n_desc: 'card_rankings_desc',  href: 'rankings.html' },
        ];

        const container = document.getElementById('cards');
        cards.forEach(c => {
            const a = document.createElement('a');
            a.className = 'm-card';
            a.href = c.href;
            a.innerHTML =
                '<span class="m-card-icon">' + c.icon + '</span>' +
                '<div class="m-card-text">' +
                '<div class="m-card-title" data-i18n="' + c.i18n_title + '">' + i18n.t(c.i18n_title) + '</div>' +
                '<div class="m-card-desc" data-i18n="' + c.i18n_desc + '">' + i18n.t(c.i18n_desc) + '</div>' +
                '</div>';
            container.appendChild(a);
        });

        // Animate a number from 0 to target with rolling digits
        function animateNumber(el, target, duration) {
            if (!el || !target) return;
            const start = performance.now();
            const fmt = v => i18n.fmtNum(Math.round(v));
            el.textContent = fmt(0);
            function step(now) {
                const t = Math.min((now - start) / duration, 1);
                const ease = 1 - Math.pow(1 - t, 3);
                el.textContent = fmt(ease * target);
                if (t < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        // Load stats from map data
        Promise.all(
            ['16','17','18','19','20','21','22','23','24','25'].map(e =>
                fetch('../data/map_' + e + '.json').then(r => r.json()).catch(() => null)
            )
        ).then(all => {
            const maps = all.filter(Boolean);
            if (!maps.length) return;
            const maxBallots = Math.max(...maps.map(m => m.stats.totalBallots));
            const latest = maps[maps.length - 1];
            animateNumber(document.getElementById('stat-ballots'), maxBallots, 1200);
            animateNumber(document.getElementById('stat-settlements'), latest.stats.totalSettlements, 1200);
            animateNumber(document.getElementById('stat-eligible'), latest.stats.totalEligible, 1500);
            animateNumber(document.getElementById('stat-voted'), latest.stats.totalVoters, 1500);
            animateNumber(document.getElementById('stat-lists'), latest.stats.totalLists, 800);
        }).catch(() => {});

        // Visitor counter
        (function() {
            const KEY = 'kolot_visit_counted';
            const ns = 'kolot-nodedim', k = 'page-visits';
            const counted = sessionStorage.getItem(KEY);
            const url = counted
                ? 'https://api.counterapi.dev/v1/' + ns + '/' + k + '/'
                : 'https://api.counterapi.dev/v1/' + ns + '/' + k + '/up';
            fetch(url).then(r => r.json()).then(d => {
                const n = d.count || d.value || 0;
                if (n > 0) {
                    animateNumber(document.getElementById('stat-visitors'), n, 1200);
                    if (!counted) sessionStorage.setItem(KEY, '1');
                }
            }).catch(() => {});
        })();

        window.addEventListener('langchange', () => i18n.applyTranslations());
    })();
    </script>
</body>
</html>
